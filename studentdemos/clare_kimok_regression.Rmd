---
title: "Correlation and Regression Demonstration"
author: "Clare Kimock"
date: "February 13, 2015"
output: html_document
---
###Gordon et al. 2008 - The <i>Homo floresiensis</i> cranium (LB1): Size, scaling and early <i>Homo</i> affinities

####First, read in the data:

```{r}
Howell <- read.csv("http://hompal-stats.wabarr.com/datasets/Howell_craniometry.csv", header = TRUE, na.strings = 0)
head(Howell)
```
Since we are only interested in a few of the measurements in the dataset, we can create a new dataframe that includes only the relevant data:

```{r}
library(dplyr)

Howell <- tbl_df(Howell)

Howell.Selected <- select(Howell, ID:Population, GOL, BBH, XCB, BNL, BPL, ASB)

head(Howell.Selected)
```

Next, we need to read in the fossil craniometric data used in the paper:

```{r}
Fossil <- read.csv("http://hompal-stats.wabarr.com/datasets/Gordon_2008_cranial.csv", header = TRUE)
head(Fossil)
```

####Next, calculate the geometric mean for each individual in both datasets:

Recall from Homework #2:

```{r}
geomean <- function(x, na.rm = TRUE) {
  product <- prod(x, na.rm = TRUE)
  n <- sum(!is.na(x))
  Geomean <- product ^ (1/n)
  Geomean
  }
```

Now we can calculate the geometric mean of the six cranial measurements of interest for each specimen in the Howell dataset:

```{r}
Howell.Geomean <- numeric(nrow(Howell.Selected))

for(i in 1:nrow(Howell)) {Howell.Row.Geomean <- (geomean(Howell.Selected[i, -(1:4)]))
Howell.Geomean[i] <- Howell.Row.Geomean
}

head(Howell.Geomean)

```

And then we can add it to the Howell.Selected dataframe:

```{r}
Howell.Selected$Geomean <- Howell.Geomean
head(Howell.Selected)
```

We can do the same for the fossils:

```{r}
Fossil.Geomean <- numeric(nrow(Fossil))

for(i in 1:nrow(Fossil)) {Fossil.Row.Geomean <- (geomean(Fossil[i, -(1:2)]))
Fossil.Geomean[i] <- Fossil.Row.Geomean
}

head(Fossil.Geomean)
```

And add a geometric mean column to the Fossil dataframe as well:

```{r}
Fossil$Geomean <- Fossil.Geomean
head(Fossil)
```

####Make the Plots

```{r}
library(ggplot2)

#library(lmodel2)

GOL_y <- c(log(Fossil$GOL[7]), log(Fossil$GOL[8]))

x <- c(log(Fossil$Geomean[7]), log(Fossil$Geomean[8]))

GOL_Slope <- (GOL_y[2] - GOL_y[1]) / (x[2] - x[1])

GOL_Intercept <- GOL_y[2] - (GOL_Slope*(x[2]))

GOL_Plot <- ggplot(data = Howell.Selected, aes(x = log(Geomean), y = log(GOL))) + geom_point(color = "gray") + labs(x = "ln GM (ln mm)", y = "ln GOL (ln mm)")  + geom_smooth(method=lm, se = FALSE, color = "gray28", linetype = 2, fullrange = TRUE) + geom_point(inherit.aes = FALSE, data = Fossil, aes(x = log(Geomean), y = log(GOL), color = Species, size = 10)) + geom_abline(intercept = GOL_Intercept, slope = GOL_Slope) + theme_bw(15) + guides(size = FALSE) 

GOL_Plot

BBH_y <- c(log(Fossil$BBH[7]), log(Fossil$BBH[8]))

x <- c(log(Fossil$Geomean[7]), log(Fossil$Geomean[8]))

BBH_Slope <- (BBH_y[2] - BBH_y[1]) / (x[2] - x[1])

BBH_Intercept <- BBH_y[2] - (BBH_Slope*(x[2]))

BBH_Plot <- ggplot(data = Howell.Selected, aes(x = log(Geomean), y = log(BBH))) + geom_point(color = "gray") + labs(x = "ln GM (ln mm)", y = "ln BBH (ln mm)")  + geom_smooth(method=lm, se = FALSE, color = "gray28", linetype = 2, fullrange = TRUE) + geom_point(inherit.aes = FALSE, data = Fossil, aes(x = log(Geomean), y = log(BBH), color = Species, size = 10)) + geom_abline(intercept = BBH_Intercept, slope = BBH_Slope) + theme_bw(15) + guides(size = FALSE) 

BBH_Plot

XCB_y <- c(log(Fossil$XCB[7]), log(Fossil$XCB[8]))

x <- c(log(Fossil$Geomean[7]), log(Fossil$Geomean[8]))

XCB_Slope <- (XCB_y[2] - XCB_y[1]) / (x[2] - x[1])

XCB_Intercept <- XCB_y[2] - (XCB_Slope*(x[2]))

XCB_Plot <- ggplot(data = Howell.Selected, aes(x = log(Geomean), y = log(XCB))) + geom_point(color = "gray") + labs(x = "ln GM (ln mm)", y = "ln XCB (ln mm)")  + geom_smooth(method=lm, se = FALSE, color = "gray28", linetype = 2, fullrange = TRUE) + geom_point(inherit.aes = FALSE, data = Fossil, aes(x = log(Geomean), y = log(XCB), color = Species, size = 10)) + geom_abline(intercept = XCB_Intercept, slope = XCB_Slope) + theme_bw(15) + guides(size = FALSE) 

XCB_Plot

BNL_y <- c(log(Fossil$BNL[7]), log(Fossil$BNL[8]))

x <- c(log(Fossil$Geomean[7]), log(Fossil$Geomean[8]))

BNL_Slope <- (BNL_y[2] - BNL_y[1]) / (x[2] - x[1])

BNL_Intercept <- BNL_y[2] - (BNL_Slope*(x[2]))

BNL_Plot <- ggplot(data = Howell.Selected, aes(x = log(Geomean), y = log(BNL))) + geom_point(color = "gray") + labs(x = "ln GM (ln mm)", y = "ln BNL (ln mm)")  + geom_smooth(method=lm, se = FALSE, color = "gray28", linetype = 2, fullrange = TRUE) + geom_point(inherit.aes = FALSE, data = Fossil, aes(x = log(Geomean), y = log(BNL), color = Species, size = 10)) + geom_abline(intercept = BNL_Intercept, slope = BNL_Slope) + theme_bw(15) + guides(size = FALSE) 

BNL_Plot 

BPL_y <- c(log(Fossil$BPL[7]), log(Fossil$BPL[8]))

x <- c(log(Fossil$Geomean[7]), log(Fossil$Geomean[8]))

BPL_Slope <- (BPL_y[2] - BPL_y[1]) / (x[2] - x[1])

BPL_Intercept <- BPL_y[2] - (BPL_Slope*(x[2]))

BPL_Plot <- ggplot(data = Howell.Selected, aes(x = log(Geomean), y = log(BPL))) + geom_point(color = "gray") + labs(x = "ln GM (ln mm)", y = "ln BPL (ln mm)")  + geom_smooth(method=lm, se = FALSE, color = "gray28", linetype = 2, fullrange = TRUE) + geom_point(inherit.aes = FALSE, data = Fossil, aes(x = log(Geomean), y = log(BPL), color = Species, size = 10)) + geom_abline(intercept = BPL_Intercept, slope = BPL_Slope) + theme_bw(15) + guides(size = FALSE) 

BPL_Plot

ASB_y <- c(log(Fossil$ASB[7]), log(Fossil$ASB[8]))

x <- c(log(Fossil$Geomean[7]), log(Fossil$Geomean[8]))

ASB_Slope <- (ASB_y[2] - ASB_y[1]) / (x[2] - x[1])

ASB_Intercept <- ASB_y[2] - (ASB_Slope*(x[2]))

ASB_Plot <- ggplot(data = Howell.Selected, aes(x = log(Geomean), y = log(ASB))) + geom_point(color = "gray") + labs(x = "ln GM (ln mm)", y = "ln ASB (ln mm)")  + geom_smooth(method=lm, se = FALSE, color = "gray28", linetype = 2, fullrange = TRUE) + geom_point(inherit.aes = FALSE, data = Fossil, aes(x = log(Geomean), y = log(ASB), color = Species), size=10) + geom_abline(intercept = ASB_Intercept, slope = ASB_Slope) + theme_bw(15)

ASB_Plot
```

####Do the analysis

In R, the function for linear regression is: lm()

This function is used to fit linear models, and takes several arguments: lm(formula = , data = , subset = , weights = , na.action, = , method = "qr", model = TRUE, x = FALSE, y = FALSE, qr = TRUE, singular.ok = TRUE, contrasts = NULL, offset, ....)

#####To do the first regression: ln GM and ln GOL:

```{r}
GOL.Regression <- lm(data = Howell.Selected, log(Howell.Selected$GOL) ~ log(Howell.Selected$Geomean))

summary(GOL.Regression)

```

#####Now, ln GM and ln BBH:

```{r}
BBH.Regression <- lm(data = Howell.Selected, log(Howell.Selected$BBH) ~ log(Howell.Selected$Geomean))

summary(BBH.Regression)
```

#####Ln GM and ln XCB:

```{r}
XCB.Regression <- lm(data = Howell.Selected, log(Howell.Selected$XCB) ~ log(Howell.Selected$Geomean))

summary(XCB.Regression)
```

#####Ln GM and ln BNL:

```{r}
BNL.Regression <- lm(data = Howell.Selected, log(Howell.Selected$BNL) ~ log(Howell.Selected$Geomean))

summary(BNL.Regression)
```

#####Ln GM and ln BPL:

```{r}
BPL.Regression <- lm(data = Howell.Selected, log(Howell.Selected$BPL) ~ log(Howell.Selected$Geomean))

summary(BPL.Regression)
```

#####Ln GM and ln ASB:

```{r}
ASB.Regression <- lm(data = Howell.Selected, log(Howell.Selected$ASB) ~ log(Howell.Selected$Geomean))

summary(ASB.Regression)
```

```{r}

```


<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>bonus_advanced_ggplot_homework</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57395681-1', 'auto');
  ga('send', 'pageview');

</script>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="icon" href="favicon.ico" type="image/x-icon">

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="libs/highlight/textmate.css"
      type="text/css" />
<script src="libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="octicons/octicons.css" type="text/css" />
<link rel="stylesheet" href="css/custom-style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->





<div id="navbar">
  <div id="navbar-container">
    <ul id="navbar-ul">
      <li><a href="index.html"><span class="mega-octicon octicon-home"></span></a></li>
      <li><a href="datasets.html">Data</a></li>
      <li><a href="schedule.html">Schedule</a></li>
      <li><a href="gettinghelp.html">Getting Help</a></li>
      <li><a href="ANTH6413_syllabus.docx">Syllabus</a></li>
    </ul>
  </div>
</div>

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">bonus_advanced_ggplot_homework</h1>

</div>


<div id="problem-3" class="section level2">
<h2>Problem 3</h2>
<div id="points-possible" class="section level3">
<h3>points possible</h3>
<ul>
<li>1 pt base setup</li>
<li>1 pt reverse axes</li>
<li>3 pts filter</li>
<li>3 rectangles</li>
<li>2 points theme elements</li>
</ul>
<pre class="r"><code>library(ggplot2)

zachos &lt;- read.table(&quot;http://hompal-stats.wabarr.com/datasets/Zachos2001Climate.txt&quot;, header=TRUE)


epochs &lt;- data.frame(epoch = c(&quot;Paleocene&quot;, &quot;Eocene&quot;, &quot;Oligocene&quot;, &quot;Miocene&quot;, &quot;Pliocene&quot;, &quot;Pleistocene&quot;, &quot;Holocene&quot;), start = c(65, 58.8, 33.9, 23.03, 5.5, 1.8, 0.01))

#the first thing I did was write this line of code, then I fine tuned it
ggplot(data=zachos, aes(x=age, y=o18)) + geom_line()</code></pre>
<p><img src="advanced_ggplot2_solution_files/figure-html/unnamed-chunk-1-1.png" width="864" /></p>
<pre class="r"><code># clearly, I still need to flip axes, filter,  then add the overlays.  We will get there.  Dont panic!
# first, I flipped the axes
ggplot(data=zachos, aes(x=age, y=o18)) + 
  geom_line() + 
  scale_y_reverse() + 
  scale_x_reverse()</code></pre>
<p><img src="advanced_ggplot2_solution_files/figure-html/unnamed-chunk-1-2.png" width="864" /></p>
<pre class="r"><code>#next, I did the filter
#note I specify that I want the filter function from the stats package like this stats::filter
#otherwise, we will get the dplyr filter function, and this is BAD
#see the end of this document for a note on the filter function
ggplot(data=zachos, aes(x=age, y=stats::filter(x=o18, filter = rep(1, 70), method=&quot;convolution&quot;))) + 
  geom_line() + 
  scale_y_reverse() + 
  scale_x_reverse()</code></pre>
<pre><code>## Warning: Removed 69 rows containing missing values (geom_path).</code></pre>
<p><img src="advanced_ggplot2_solution_files/figure-html/unnamed-chunk-1-3.png" width="864" /></p>
<pre class="r"><code>#next, I added the rectangles
#note that the start will be the xmin values for the rectangles, but we need the xmax values.
#we can take the subsequent start value as the end value for each epoch
#the last epoch being a special case with and end date of 0
epochs$end &lt;- c(epochs$start[2:length(epochs$start)], 0)

ggplot(data=zachos, aes(x=age, y=stats::filter(x=o18, filter = rep(1, 70), method=&quot;convolution&quot;))) + 
  geom_line() + 
  scale_y_reverse() + 
  scale_x_reverse() + 
  geom_rect(aes(xmin=start, xmax=end, ymin=-15, ymax=325, fill=epoch), alpha=0.3, data=epochs, inherit.aes=FALSE)</code></pre>
<pre><code>## Warning: Removed 69 rows containing missing values (geom_path).</code></pre>
<p><img src="advanced_ggplot2_solution_files/figure-html/unnamed-chunk-1-4.png" width="864" /></p>
<pre class="r"><code># the trickiest part is of the rectangles is inherit.aes=FALSE
# This is needed so the aesthetics from the base layer aren&#39;t expected
# in each of the layers.  Otherwise geom_rect will complain that it can&#39;t find &#39;age&#39; or `o181
# this is a new feature of ggplot2, so it is very tricky (it wasn&#39;t necessary when I wrote this question
# so I didn&#39;t explain it to you!)

#next, I clean up the labels and add the theme

finalPlot &lt;- ggplot(data=zachos, aes(x=age, y=stats::filter(x=o18, filter = rep(1, 70), method=&quot;convolution&quot;))) + 
  geom_line() + 
  scale_y_reverse() + 
  scale_x_reverse() + 
  geom_rect(aes(xmin=start, xmax=end, ymin=-15, ymax=325, fill=epoch), alpha=0.3, data=epochs, inherit.aes=FALSE) + 
  theme_classic(20) + 
  labs(x=&quot;Age (millions of years)&quot;, y=&quot;Smoothed values of o18&quot;, title=&quot;Temperature Proxy (o18) Through Geological Time&quot;)
finalPlot</code></pre>
<pre><code>## Warning: Removed 69 rows containing missing values (geom_path).</code></pre>
<p><img src="advanced_ggplot2_solution_files/figure-html/unnamed-chunk-1-5.png" width="864" /></p>
<pre class="r"><code>#darn it, the epochs aren&#39;t in the correct order.  I should go back and make epoch an ordered factor
epochs$epoch &lt;- ordered(epochs$epoch, levels=epochs$epoch)

finalPlot</code></pre>
<pre><code>## Warning: Removed 69 rows containing missing values (geom_path).</code></pre>
<p><img src="advanced_ggplot2_solution_files/figure-html/unnamed-chunk-1-6.png" width="864" /></p>
</div>
</div>
<div id="a-note-on-the-filter-function." class="section level2">
<h2>A note on the filter function.</h2>
<p><code>stats::filter()</code> calculates a running average by appling a moving window (or convolution filter). Basically, the filter is applied to each element in the time series, and the values within the window are averaged. The average can be weighted, so need to provide a vector of weights for how much weight to give each value in the filter window.</p>
<pre class="r"><code>randomData &lt;- rnorm(100)
plot(randomData, type=&quot;l&quot;, main=&quot;No Filter&quot;)</code></pre>
<p><img src="advanced_ggplot2_solution_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code>plot(stats::filter(randomData, rep(1, 4), method=&quot;convolution&quot;), type=&quot;l&quot;, main=&quot;Filter with window of 4, all with equal weight&quot;)</code></pre>
<p><img src="advanced_ggplot2_solution_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
<pre class="r"><code>plot(stats::filter(randomData, c(0.1, 0.4, 0.4, 0.1), method=&quot;convolution&quot;), type=&quot;l&quot;, main=&quot;Filter with window of 4, giving more weight to nearby values&quot;)</code></pre>
<p><img src="advanced_ggplot2_solution_files/figure-html/unnamed-chunk-2-3.png" width="672" /></p>
<pre class="r"><code>plot(stats::filter(randomData, rep(1, 15), method=&quot;convolution&quot;), type=&quot;l&quot;, main=&quot;Filter with window of 15, equal weight&quot;)</code></pre>
<p><img src="advanced_ggplot2_solution_files/figure-html/unnamed-chunk-2-4.png" width="672" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

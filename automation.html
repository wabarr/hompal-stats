<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta name="generator" content="pandoc" />



<title></title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="libs/bootstrap-2.3.2/css/united.min.css" rel="stylesheet" />
<link href="libs/bootstrap-2.3.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
<script src="libs/bootstrap-2.3.2/js/bootstrap.min.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57395681-1', 'auto');
  ga('send', 'pageview');

</script>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="icon" href="favicon.ico" type="image/x-icon">

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="libs/highlight/textmate.css"
      type="text/css" />
<script src="libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>


<link rel="stylesheet" href="octicons/octicons.css" type="text/css" />
<link rel="stylesheet" href="css/custom-style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
</style>
<div class="container-fluid main-container">

<div id="navbar">
  <div id="navbar-container">
    <ul id="navbar-ul">
      <li><a href="index.html"><span class="mega-octicon octicon-home"></a></li>
      <li><a href="datasets.html">Data</a></li>
      <li><a href="homework.html">Demos, Readings, & Homework</a></li>
      <li><a href="https://www.dropbox.com/s/5i83xqgfm6ud9td/ANTH6413_syllabus.docx?dl=0">Syllabus</a></li>
      <li><a href="gettinghelp.html">Getting Help</a></li>
      
    </ul>
  </div>
</div>



<div id="automation" class="section level1">
<h1>Automation</h1>
<p>R is a programming language, which means that it gives you all the tools you need to automate repetitive tasks. There are three (or more) main ways to do this:</p>
<ul>
<li><code>for</code> loops</li>
<li>the <code>lapply()</code> function</li>
<li>the <code>dplyr</code> package</li>
</ul>
<div id="for-loops" class="section level2">
<h2>for loops</h2>
<p><code>for</code> loops will be familiar if you have ever used any other programming languages. The basic structure looks like this:</p>
<pre class="r"><code>vector &lt;- 1:10
for(i in vector){
  #do something with i
}</code></pre>
<p>Here is a (slightly) more complicated example.</p>
<pre class="r"><code>myVector &lt;- 1:10
for(counter in myVector){
  result &lt;- paste(&quot;counter ^ 2 = &quot;, counter^2)
  print(result)
}</code></pre>
<pre><code>## [1] &quot;counter ^ 2 =  1&quot;
## [1] &quot;counter ^ 2 =  4&quot;
## [1] &quot;counter ^ 2 =  9&quot;
## [1] &quot;counter ^ 2 =  16&quot;
## [1] &quot;counter ^ 2 =  25&quot;
## [1] &quot;counter ^ 2 =  36&quot;
## [1] &quot;counter ^ 2 =  49&quot;
## [1] &quot;counter ^ 2 =  64&quot;
## [1] &quot;counter ^ 2 =  81&quot;
## [1] &quot;counter ^ 2 =  100&quot;</code></pre>
<p>We loop over a vector <code>1:100</code>, and sequentially assign its values to a temporary variable we are calling <code>counter</code>. (Note: we can call this variable whatever we want.) Then R does what is within the curly braces <code>{}</code> for each iteration of the loop. In this case, it pastes together some text with the square of the value of <code>counter</code> and prints this all to the console.</p>
<p><span class="mega-octicon octicon-question"></span> After running the above code, what is the value of <code>counter</code>? What is the value of <code>myVector</code>? Has this value changed?</p>
<div id="getting-stuff-out-of-a-loop" class="section level3">
<h3>getting stuff out of a loop</h3>
<p>Often, we want to do some calculations, and save the results outside of the <code>for</code> loop. To do this, we can create a results vector in advance that is the same length as the vector we are looping over, then we can save the results each time in the appropriate slot.</p>
<pre class="r"><code>myVector &lt;- runif(100, min = 1, max=10)
myVector</code></pre>
<pre><code>##   [1] 5.872712 8.706885 5.372279 5.431910 5.746688 9.175216 2.667616 8.648403 1.638000 3.669884 5.725949 4.298702
##  [13] 1.849828 1.548341 9.432281 8.920411 4.838283 9.869404 3.594528 1.323752 2.762394 6.979150 2.185422 2.604536
##  [25] 7.365861 8.387940 9.289674 8.964682 8.005811 3.968334 2.383088 2.532979 9.985105 5.867620 5.849852 2.869900
##  [37] 8.851344 8.273466 3.574356 2.066993 9.204408 8.038600 4.456894 3.249182 5.147688 2.793130 4.455020 5.226459
##  [49] 7.734767 4.316536 8.414954 7.488502 9.401118 7.658931 9.286624 5.338744 5.458349 6.313822 9.033870 1.653721
##  [61] 5.378449 9.602601 7.252317 6.758139 5.261881 3.797482 3.192868 3.488649 8.593324 7.379458 9.834213 6.320448
##  [73] 7.857327 6.448723 9.683479 5.720221 3.084684 4.226996 3.021702 5.621177 7.483933 5.474256 2.379054 5.549640
##  [85] 6.576813 1.720672 3.457739 8.027452 1.776444 1.458750 4.186715 6.467928 5.127961 1.547499 6.471671 8.054929
##  [97] 5.449597 5.203896 7.678532 5.152240</code></pre>
<pre class="r"><code>results &lt;- numeric(100)
for(each in 1:length(myVector)){
  results[each] &lt;- paste(myVector[each], &quot;^ 2 = &quot;, myVector[each]^2)
}

##now get some of the stored results
results[50]</code></pre>
<pre><code>## [1] &quot;4.31653565750457 ^ 2 =  18.6324800825084&quot;</code></pre>
<pre class="r"><code>results[73]</code></pre>
<pre><code>## [1] &quot;7.85732692363672 ^ 2 =  61.7375863849065&quot;</code></pre>
</div>
<div id="if-statements" class="section level3">
<h3><code>if</code> statements</h3>
<p>Often during a loop, you may want to do a test and do something different based on the results of the test. Imagine a vector of germination outcomes from a seed experiment. 0 indicates the seed did not germinate due to insect predatoin, 1 indicates that it did not germinate but no insect predation occurrend, 2 indicates that the seed germinated. We can use the <code>if()</code> function to evaluate the outcome and provide context specific output.</p>
<pre class="r"><code>outcomes &lt;- c(0,1,0,2,0,1,0,2,0,1,0,1,0,0)
for(trial in outcomes){
  if(trial == 2) print(&quot;Welcome to the world, plantling!&quot;)
  else print(&quot;RIP&quot;)
}</code></pre>
<pre><code>## [1] &quot;RIP&quot;
## [1] &quot;RIP&quot;
## [1] &quot;RIP&quot;
## [1] &quot;Welcome to the world, plantling!&quot;
## [1] &quot;RIP&quot;
## [1] &quot;RIP&quot;
## [1] &quot;RIP&quot;
## [1] &quot;Welcome to the world, plantling!&quot;
## [1] &quot;RIP&quot;
## [1] &quot;RIP&quot;
## [1] &quot;RIP&quot;
## [1] &quot;RIP&quot;
## [1] &quot;RIP&quot;
## [1] &quot;RIP&quot;</code></pre>
</div>
<div id="challenge" class="section level3">
<h3><span class="mega-octicon octicon-puzzle"></span> Challenge</h3>
<p>Write a <code>for</code> loop to examine the law of large numbers to illustrate how, as sample size increases, estimates of the mean of a population converge on the true value. Do this in the following steps:</p>
<ul>
<li>create a numeric results vector of length 2000</li>
<li>loop over each integer <code>i</code> from 1 to 2000</li>
<li>at each iteration use the <code>rnorm()</code> function to simulate a sample of size <code>i</code> from a population with a mean of 100 and standard deviation of 30.</li>
<li>calculate the mean of this sample, and be sure to save these results to the appropriate place in the results vector</li>
<li>finally, make a plot of the results with the integers 1 to 2000 on the x axis, and the corresponding value from the results vector on the y axis</li>
</ul>
</div>
</div>
<div id="lapply-writing-your-own-functions" class="section level2">
<h2>lapply + writing your own functions</h2>
<p>The function <code>lapply()</code> is like a <code>for</code> loop, but is optimized and explicitly functional. <code>lapply()</code> usually takes two arguments <code>X</code> which is a list or a vector to loop over, and <code>FUN</code> which is a function to apply to each element of <code>X</code>. Thus, <code>FUN</code> must be able to accept any element of <code>X</code> as an argument. The clearest way is to write your own function.</p>
</div>
<div id="writing-functions" class="section level2">
<h2>Writing functions</h2>
<p>Functions are the best way to encapsulate code that you want to repeat again and again. A function accepts <strong>arguments</strong> and <strong>returns</strong> a single (and only a single) object (but this can be a single number, list, dataframe, vector, etc.). Variable names defined within a function only exist within the function (not within the global environment).</p>
<pre class="r"><code>is.even &lt;- function(number){
  if(number %% 2 == 0) {return(&quot;The number is even&quot;)}
  else {return(&quot;The number is not even&quot;)}
}

is.even(1233)</code></pre>
<pre><code>## [1] &quot;The number is not even&quot;</code></pre>
<pre class="r"><code>is.even(1234)</code></pre>
<pre><code>## [1] &quot;The number is even&quot;</code></pre>
<pre class="r"><code>is.even(-1.2)</code></pre>
<pre><code>## [1] &quot;The number is not even&quot;</code></pre>
</div>
<div id="lists" class="section level2">
<h2>Lists</h2>
<p>The “l” in <code>lapply()</code> stands for “list”, because that’s what you get as a result. Lists are kind of like vectors, but with important differences:</p>
<div id="lists-can-hold-any-type-of-data-and-not-every-element-needs-to-be-the-same-type." class="section level4">
<h4><strong>lists can hold any type of data, and not every element needs to be the same type.</strong></h4>
<pre class="r"><code>myList &lt;- list(firstOne=1, nextOne=&quot;too&quot;, lastOne=rnorm(10))
myList</code></pre>
<pre><code>## $firstOne
## [1] 1
## 
## $nextOne
## [1] &quot;too&quot;
## 
## $lastOne
##  [1] -0.26598386  0.54941269  0.10500747  1.30512873  0.50115399 -0.57491643  1.32396360 -0.09465960 -0.55109220
## [10]  0.02117942</code></pre>
</div>
<div id="you-use-double-brackets-to-index-a-list" class="section level4">
<h4>you use double brackets <code>[[]]</code> to index a list</h4>
<pre class="r"><code>myList[[3]]</code></pre>
<pre><code>##  [1] -0.26598386  0.54941269  0.10500747  1.30512873  0.50115399 -0.57491643  1.32396360 -0.09465960 -0.55109220
## [10]  0.02117942</code></pre>
</div>
<div id="lists-can-optionally-have-named-elements-that-can-be-accessed-using-the-operator" class="section level4">
<h4>lists can (optionally) have named elements, that can be accessed using the <code>$</code> operator</h4>
<pre class="r"><code>myList$nextOne</code></pre>
<pre><code>## [1] &quot;too&quot;</code></pre>
</div>
<div id="where-have-you-seen-the-operator-before" class="section level3">
<h3><span class="mega-octicon octicon-question"></span> Where have you seen the <code>$</code> operator before?</h3>
<p>What does this suggest about the relationship between list and dataframes?</p>
</div>
<div id="lists-are-useful-because-of-their-flexibility." class="section level3">
<h3>Lists are useful because of their flexibility.</h3>
<p>We can store complex results from each iteration, and then come back to these results later.</p>
<pre class="r"><code># note, we must accept an argument
# even if we don&#39;t do anything with this argument.
summarizeRandom &lt;- function(n){
  sample &lt;- rnorm(n)
  mySummary &lt;- summary(sample)
  return(mySummary)
}

sampleSizes &lt;- 100:200
myResults &lt;- lapply(sampleSizes, FUN=summarizeRandom)
myResults[1:3]</code></pre>
<pre><code>## [[1]]
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## -2.59300 -0.62550 -0.11540 -0.08034  0.52360  3.05100 
## 
## [[2]]
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## -2.04200 -0.68850 -0.12030 -0.03368  0.64850  2.00100 
## 
## [[3]]
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## -3.3320 -0.7174  0.2564  0.0746  0.9122  2.0850</code></pre>
</div>
</div>
<div id="the-dplyr-package" class="section level2">
<h2>the dplyr package</h2>
<p>This a user-contributed package that has kind of revolutionized working with data in R. It provides a consistent and simpler interface to do things that you could also do using loops or base functions in R. It is less flexible than a for loop or <code>lapply()</code>, but it is easier to use, and works for the most common data manipulation tasks.</p>
<p><code>dplyr</code> is very consistent: it assumes that you are starting with a dataframe, doing something to that dataframe, and finishing with a different dataframe. (Many of the base functions operate on vectors, which makes it more complicated to apply them to dataframes.) <code>dplyr</code> introduces a series of simple ‘verbs’ that describe many common data manipulation tasks.</p>
<div id="challenge-1" class="section level3">
<h3><span class="mega-octicon octicon-puzzle"></span> Challenge</h3>
<p>We will use a dataset on student loans in public and private universities. Read in this dataset called ‘DMV_2014_Q3_Undergrad_DirectLoans.csv’ and save it to a variable called <code>loans</code>.</p>
<p><strong>Note</strong> before getting started, lets convert our <code>loans</code> object to a tbl_df object, which is just like a normal dataframe, but doesn’t print all its rows to the screen. This function is part of <code>dplyr</code>, so we need to load it first.</p>
<pre class="r"><code>library(dplyr)
loans &lt;- tbl_df(loans)</code></pre>
</div>
<div id="the-basic-dplyr-verbs" class="section level3">
<h3>The basic dplyr verbs</h3>
<p>There are a few basic functions in <code>dplyr</code>, which are designed to help you think about the most common data manipulation tasks that you will need to do. The first argument to these functions is always the dataframe that you want to manipulate. Within these function calls, you can refer to the names of columns in the dataframe without quotation marks and without the usual <code>$</code> syntax.</p>
</div>
<div id="filter" class="section level3">
<h3><code>filter()</code></h3>
<p>This function selects a subset of rows meeting some criterion. Note that the result is a dataframe.</p>
<pre class="r"><code>filter(loans, School==&quot;GEORGE WASHINGTON UNIVERSITY&quot;)</code></pre>
<pre><code>## Source: local data frame [1 x 5]
## 
##                         School State      School_Type SubsidizedDL UNSubsidizedDL
## 1 GEORGE WASHINGTON UNIVERSITY    DC PrivateNonprofit      7463145        5913027</code></pre>
</div>
<div id="arrange" class="section level3">
<h3><code>arrange()</code></h3>
<p>This function is like the “sort” function in MS Excel. You simply provide a list of column names to sort by:</p>
<pre class="r"><code>arrange(loans, State, SubsidizedDL)</code></pre>
<pre><code>## Source: local data frame [210 x 5]
## 
##                                    School State      School_Type SubsidizedDL UNSubsidizedDL
## 1  NATIONAL CONSERVATORY OF DRAMATIC ARTS    DC PrivateNonprofit        40812          21963
## 2              TECHNICAL LEARNING CENTERS    DC      Proprietary        84000         128000
## 3                BENNETT CAREER INSTITUTE    DC      Proprietary       107642          88632
## 4                         RADIANS COLLEGE    DC      Proprietary       340038         514081
## 5      CORCORAN COLLEGE OF ART AND DESIGN    DC PrivateNonprofit       356355         360715
## 6              CAREER TECHNICAL INSTITUTE    DC      Proprietary       416911         685909
## 7                    GALLAUDET UNIVERSITY    DC PrivateNonprofit       679602         561785
## 8                         TRINITY COLLEGE    DC PrivateNonprofit      2522961        2850888
## 9          CATHOLIC UNIVERSITY OF AMERICA    DC PrivateNonprofit      3619502        3520966
## 10                  GEORGETOWN UNIVERSITY    DC PrivateNonprofit      3824260        1318290
## ..                                    ...   ...              ...          ...            ...</code></pre>
<pre class="r"><code>arrange(loans, State, desc(SubsidizedDL))</code></pre>
<pre><code>## Source: local data frame [210 x 5]
## 
##                                    School State      School_Type SubsidizedDL UNSubsidizedDL
## 1                      STRAYER UNIVERSITY    DC      Proprietary     22490396       34840102
## 2                       HOWARD UNIVERSITY    DC PrivateNonprofit      9414766        9021712
## 3            GEORGE WASHINGTON UNIVERSITY    DC PrivateNonprofit      7463145        5913027
## 4                     AMERICAN UNIVERSITY    DC PrivateNonprofit      6213538        4517728
## 5  UNIVERSITY OF THE DISTRICT OF COLUMBIA    DC           Public      3850272        4248284
## 6                   GEORGETOWN UNIVERSITY    DC PrivateNonprofit      3824260        1318290
## 7          CATHOLIC UNIVERSITY OF AMERICA    DC PrivateNonprofit      3619502        3520966
## 8                         TRINITY COLLEGE    DC PrivateNonprofit      2522961        2850888
## 9                    GALLAUDET UNIVERSITY    DC PrivateNonprofit       679602         561785
## 10             CAREER TECHNICAL INSTITUTE    DC      Proprietary       416911         685909
## ..                                    ...   ...              ...          ...            ...</code></pre>
</div>
<div id="select" class="section level3">
<h3><code>select()</code></h3>
<p>This function pulls out colums of interest. You can select ranges of columns using the <code>:</code> operator syntax. (Note: usually this only works with numeric data, but this is a special usage defined in the <code>dplyr</code> package)</p>
<pre class="r"><code>select(loans, State, SubsidizedDL)</code></pre>
<pre><code>## Source: local data frame [210 x 2]
## 
##    State SubsidizedDL
## 1     DC      6213538
## 2     DC      3619502
## 3     DC      3850272
## 4     DC       679602
## 5     DC      7463145
## 6     DC      3824260
## 7     DC      9414766
## 8     DC     22490396
## 9     DC      2522961
## 10    DC           NA
## ..   ...          ...</code></pre>
<pre class="r"><code>select(loans, -State, -SubsidizedDL)</code></pre>
<pre><code>## Source: local data frame [210 x 3]
## 
##                                    School      School_Type UNSubsidizedDL
## 1                     AMERICAN UNIVERSITY PrivateNonprofit        4517728
## 2          CATHOLIC UNIVERSITY OF AMERICA PrivateNonprofit        3520966
## 3  UNIVERSITY OF THE DISTRICT OF COLUMBIA           Public        4248284
## 4                    GALLAUDET UNIVERSITY PrivateNonprofit         561785
## 5            GEORGE WASHINGTON UNIVERSITY PrivateNonprofit        5913027
## 6                   GEORGETOWN UNIVERSITY PrivateNonprofit        1318290
## 7                       HOWARD UNIVERSITY PrivateNonprofit        9021712
## 8                      STRAYER UNIVERSITY      Proprietary       34840102
## 9                         TRINITY COLLEGE PrivateNonprofit        2850888
## 10            WESLEY THEOLOGICAL SEMINARY PrivateNonprofit          22250
## ..                                    ...              ...            ...</code></pre>
<pre class="r"><code>select(loans, State:SubsidizedDL)</code></pre>
<pre><code>## Source: local data frame [210 x 3]
## 
##    State      School_Type SubsidizedDL
## 1     DC PrivateNonprofit      6213538
## 2     DC PrivateNonprofit      3619502
## 3     DC           Public      3850272
## 4     DC PrivateNonprofit       679602
## 5     DC PrivateNonprofit      7463145
## 6     DC PrivateNonprofit      3824260
## 7     DC PrivateNonprofit      9414766
## 8     DC      Proprietary     22490396
## 9     DC PrivateNonprofit      2522961
## 10    DC PrivateNonprofit           NA
## ..   ...              ...          ...</code></pre>
</div>
<div id="distinct" class="section level3">
<h3><code>distinct()</code></h3>
<p>This function extracts the distinct rows. It is most useful when combined with select</p>
<pre class="r"><code>distinct(loans)</code></pre>
<pre><code>## Source: local data frame [210 x 5]
## 
##                                    School State      School_Type SubsidizedDL UNSubsidizedDL
## 1                     AMERICAN UNIVERSITY    DC PrivateNonprofit      6213538        4517728
## 2          CATHOLIC UNIVERSITY OF AMERICA    DC PrivateNonprofit      3619502        3520966
## 3  UNIVERSITY OF THE DISTRICT OF COLUMBIA    DC           Public      3850272        4248284
## 4                    GALLAUDET UNIVERSITY    DC PrivateNonprofit       679602         561785
## 5            GEORGE WASHINGTON UNIVERSITY    DC PrivateNonprofit      7463145        5913027
## 6                   GEORGETOWN UNIVERSITY    DC PrivateNonprofit      3824260        1318290
## 7                       HOWARD UNIVERSITY    DC PrivateNonprofit      9414766        9021712
## 8                      STRAYER UNIVERSITY    DC      Proprietary     22490396       34840102
## 9                         TRINITY COLLEGE    DC PrivateNonprofit      2522961        2850888
## 10            WESLEY THEOLOGICAL SEMINARY    DC PrivateNonprofit           NA          22250
## ..                                    ...   ...              ...          ...            ...</code></pre>
<pre class="r"><code>distinct(select(loans, State, School_Type))</code></pre>
<pre><code>## Source: local data frame [9 x 2]
## 
##   State      School_Type
## 1    DC PrivateNonprofit
## 2    DC           Public
## 3    DC      Proprietary
## 4    MD PrivateNonprofit
## 5    MD           Public
## 6    MD      Proprietary
## 7    VA PrivateNonprofit
## 8    VA           Public
## 9    VA      Proprietary</code></pre>
</div>
<div id="mutate" class="section level3">
<h3><code>mutate()</code></h3>
<p>Adds new columns that are some function of existing columns</p>
<pre class="r"><code>mutate(loans, Total_Loans = SubsidizedDL + UNSubsidizedDL)</code></pre>
<pre><code>## Source: local data frame [210 x 6]
## 
##                                    School State      School_Type SubsidizedDL UNSubsidizedDL Total_Loans
## 1                     AMERICAN UNIVERSITY    DC PrivateNonprofit      6213538        4517728    10731266
## 2          CATHOLIC UNIVERSITY OF AMERICA    DC PrivateNonprofit      3619502        3520966     7140468
## 3  UNIVERSITY OF THE DISTRICT OF COLUMBIA    DC           Public      3850272        4248284     8098556
## 4                    GALLAUDET UNIVERSITY    DC PrivateNonprofit       679602         561785     1241387
## 5            GEORGE WASHINGTON UNIVERSITY    DC PrivateNonprofit      7463145        5913027    13376172
## 6                   GEORGETOWN UNIVERSITY    DC PrivateNonprofit      3824260        1318290     5142550
## 7                       HOWARD UNIVERSITY    DC PrivateNonprofit      9414766        9021712    18436478
## 8                      STRAYER UNIVERSITY    DC      Proprietary     22490396       34840102    57330498
## 9                         TRINITY COLLEGE    DC PrivateNonprofit      2522961        2850888     5373849
## 10            WESLEY THEOLOGICAL SEMINARY    DC PrivateNonprofit           NA          22250          NA
## ..                                    ...   ...              ...          ...            ...         ...</code></pre>
</div>
<div id="summarise" class="section level3">
<h3><code>summarise()</code></h3>
<p>Summarizes data into a single row. This may seem not that useful, but it will become useful when we start grouping data.</p>
<pre class="r"><code>summarise(loans, meanSubDL = mean(SubsidizedDL, na.rm=TRUE))</code></pre>
<pre><code>## Source: local data frame [1 x 1]
## 
##   meanSubDL
## 1   2607474</code></pre>
</div>
<div id="grouping-data" class="section level3">
<h3>Grouping Data</h3>
<p>These functions above get really powerful when you start grouping data based on factors in your dataset.</p>
</div>
<div id="group_by" class="section level3">
<h3><code>group_by</code></h3>
<pre class="r"><code>groupedLoans &lt;- group_by(loans, State)
groupedLoans</code></pre>
<pre><code>## Source: local data frame [210 x 5]
## Groups: State
## 
##                                    School State      School_Type SubsidizedDL UNSubsidizedDL
## 1                     AMERICAN UNIVERSITY    DC PrivateNonprofit      6213538        4517728
## 2          CATHOLIC UNIVERSITY OF AMERICA    DC PrivateNonprofit      3619502        3520966
## 3  UNIVERSITY OF THE DISTRICT OF COLUMBIA    DC           Public      3850272        4248284
## 4                    GALLAUDET UNIVERSITY    DC PrivateNonprofit       679602         561785
## 5            GEORGE WASHINGTON UNIVERSITY    DC PrivateNonprofit      7463145        5913027
## 6                   GEORGETOWN UNIVERSITY    DC PrivateNonprofit      3824260        1318290
## 7                       HOWARD UNIVERSITY    DC PrivateNonprofit      9414766        9021712
## 8                      STRAYER UNIVERSITY    DC      Proprietary     22490396       34840102
## 9                         TRINITY COLLEGE    DC PrivateNonprofit      2522961        2850888
## 10            WESLEY THEOLOGICAL SEMINARY    DC PrivateNonprofit           NA          22250
## ..                                    ...   ...              ...          ...            ...</code></pre>
<pre class="r"><code>summarise(groupedLoans, meanSubDL = mean(SubsidizedDL, na.rm=TRUE))</code></pre>
<pre><code>## Source: local data frame [3 x 2]
## 
##   State meanSubDL
## 1    DC   4094947
## 2    MD   2132025
## 3    VA   2730055</code></pre>
</div>
<div id="chaining-operations" class="section level3">
<h3>Chaining operations</h3>
<p><code>dplyr</code> also provides a way of chaining together commplicated operations with the <code>%&gt;%</code> operator. This prevents having to save intermediate steps, or to have a complicated series of nested functions. Note that the resulting dataframe from each step is passed as the first argument to the next function in the chain. For instance.</p>
<pre class="r"><code>group_by(loans, School_Type) %&gt;%
  mutate(Total_Loans = SubsidizedDL + UNSubsidizedDL) %&gt;%
  select(-State) %&gt;%
  summarise(mean_total_loans = mean(Total_Loans, na.rm=TRUE))</code></pre>
<pre><code>## Source: local data frame [3 x 2]
## 
##        School_Type mean_total_loans
## 1 PrivateNonprofit          5115076
## 2      Proprietary          1796278
## 3           Public         10315783</code></pre>
<p><strong>Note:</strong> If you like this idea of chaining operations, this actually comes from a separate package called <code>magrittr</code>, which <code>dplyr</code> relies on. If you want you can use this in your non <code>dplyr</code> code as well. Notice that in the example below, if you are piping to a function that only needs 1 argument, you can leave out the parentheses, and just type the name of the function.</p>
<pre class="r"><code>library(magrittr)
library(ggplot2)

#chained syntax
rnorm(1000, mean=20, sd=1.4) %&gt;% log %&gt;% qplot</code></pre>
<pre><code>## stat_bin: binwidth defaulted to range/30. Use &#39;binwidth = x&#39; to adjust this.</code></pre>
<p><img src="automation_files/figure-html/unnamed-chunk-22-1.png" title="" alt="" width="672" /></p>
<pre class="r"><code>#compare with nested function calls 

qplot(log(rnorm(1000, mean=20, sd=1.4)))</code></pre>
<pre><code>## stat_bin: binwidth defaulted to range/30. Use &#39;binwidth = x&#39; to adjust this.</code></pre>
<p><img src="automation_files/figure-html/unnamed-chunk-22-2.png" title="" alt="" width="672" /></p>
</div>
<div id="challenge-2" class="section level3">
<h3><span class="mega-octicon octicon-puzzle"></span> Challenge</h3>
<p>Using the <code>diamonds</code> dataset that is built in to the <code>ggplot2</code> package:</p>
<ul>
<li>calculate the mean price of diamonds for each of the different clarity ratings</li>
<li>create a new column called <code>volume</code> that is the product of x, y and z</li>
<li>plot <code>volume</code> against <code>carat</code></li>
</ul>
</div>
<div id="more-info" class="section level3">
<h3>More info</h3>
<p>A more complete introduction is available in the <a href="http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html"><code>dplyr</code> vignette</a></p>
<p>More info on <code>magrittr</code> <a href="http://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html">can be found here</a>.</p>
</div>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with --self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

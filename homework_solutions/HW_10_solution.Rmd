---
title: 'Homework #10 Solution'
output: html_document
---

## 9 pts total

### A.  1 pt - Read in the [morphometric data from Barr, 2014](http://hompal-stats.wabarr.com/datasets/barr_astrag_2014.txt) on bovid astragali. 

```{r}
astrag <- read.table("http://hompal-stats.wabarr.com/datasets/barr_astrag_2014.txt", header=TRUE, sep="\t")
head(astrag)
```

### B. 1 pt - Select the following colums from the data: `Taxon`, `B`, `DistRad`, and `Habitat`.  Create a new dataframe with the `Taxon`, the `Habitat` and  species means for `B` and `DistRad`.

```{r}
library(dplyr)
selectedAstrag <- 
  astrag %>% 
  select(Taxon, B, DistRad, Habitat) %>%
  group_by(Taxon) %>%
  summarise(B = mean(B), DistRad = mean(DistRad), Habitat=unique(Habitat))
```


### C. 1 pt -  Read in [the ruminant phylogeny from Hernández Fernández & Vrba, 2007](http://hompal-stats.wabarr.com/datasets/ruminants.phy). 

```{r}
#note I can load caper, which loads ape automatically and gives me access to the function read.tree()
library(caper)
rum <- read.tree("http://hompal-stats.wabarr.com/datasets/ruminants.phy")
rum
```

### D.  1 pt - Combine the data and the tree using `comparative.data()` to ready the tree for pgls.  ***Note: if you used `dplyr` in the steps above, you need to change the class of the resulting dataframe, because there is a bug in `caper` and it won't deal with a `dplyr` `tbl_df` object.  You can use this line of code to fix it `class(dataframeFromDplyr) <- "data.frame"`***

```{r}
class(selectedAstrag) <- "data.frame"
compDat <- comparative.data(phy = rum, data = selectedAstrag, names.col = "Taxon")
```

### E. 2 pts -  Plot the trimmed tree that includes just the taxa of interest in the astragalus dataset. Make it as beautiful as you can. 

```{r, fig.height=11, fig.height=11}
plot(compDat$phy)
```

### F. 2 pts -  Perform PGLS to test the hypothesis that `log(B)` is a function of `log(DistRad)`, while controling for phylogenetic signal.

```{r}
summary(pgls(log(B)~log(DistRad) + sqrt(log(B) * log(DistRad)), data=compDat, lambda="ML"))
``` 

### G. 1 pt - Plot `log(B)` as a function of  `log(DistRad)`, and color code the points by habitat type.

```{r}
library(ggplot2)
qplot(log(DistRad), log(B), data=compDat$data, color=Habitat, size=I(4)) + theme_bw(30)
```
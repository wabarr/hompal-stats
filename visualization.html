<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>Visualizing Data</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57395681-1', 'auto');
  ga('send', 'pageview');

</script>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="icon" href="favicon.ico" type="image/x-icon">

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="libs/highlight/textmate.css"
      type="text/css" />
<script src="libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>


<link rel="stylesheet" href="octicons/octicons.css" type="text/css" />
<link rel="stylesheet" href="css/custom-style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<div id="navbar">
  <div id="navbar-container">
    <ul id="navbar-ul">
      <li><a href="index.html"><span class="mega-octicon octicon-home"></a></li>
      <li><a href="datasets.html">Data</a></li>
      <li><a href="homework.html">Demos, Readings, & Homework</a></li>
      <li><a href="https://www.dropbox.com/s/5i83xqgfm6ud9td/ANTH6413_syllabus.docx?dl=0">Syllabus</a></li>
      <li><a href="gettinghelp.html">Getting Help</a></li>
      
    </ul>
  </div>
</div>

<div id="header">
<h1 class="title">Visualizing Data</h1>
</div>


<div id="i-am-opinionated-when-it-comes-to-graphics-in-r." class="section level2">
<h2>I am opinionated when it comes to graphics in R.</h2>
<p>I prefer to not to use the standard graphics facilities in R, which are rather kludgy and take lots of tweaking to make the graphs look great. Instead, I prefer to use the <code>ggplot2</code> package. You need to install this package using the standard package manager: Tools &gt; Package Manager. Then you will load the package using the command <code>library(ggplot2)</code>.</p>
<p><code>ggplot2</code> provides a convenient function called <code>qplot()</code> for making quick plots that don’t require a lot of customization.</p>
</div>
<div id="basic-plotting" class="section level2">
<h2>Basic Plotting</h2>
<p>We will use a built in dataset called <code>diamonds</code>. Lets take a look at the head (i.e. first few rows) of this dataset.</p>
<pre class="r"><code>library(ggplot2)
head(diamonds)</code></pre>
<pre><code>##   carat       cut color clarity depth table price    x    y    z
## 1  0.23     Ideal     E     SI2  61.5    55   326 3.95 3.98 2.43
## 2  0.21   Premium     E     SI1  59.8    61   326 3.89 3.84 2.31
## 3  0.23      Good     E     VS1  56.9    65   327 4.05 4.07 2.31
## 4  0.29   Premium     I     VS2  62.4    58   334 4.20 4.23 2.63
## 5  0.31      Good     J     SI2  63.3    58   335 4.34 4.35 2.75
## 6  0.24 Very Good     J    VVS2  62.8    57   336 3.94 3.96 2.48</code></pre>
<div id="univariate-plot" class="section level3">
<h3>Univariate plot</h3>
<p>The simplest usage of <code>qplot()</code> is to provide a variable for the x axis, and a dataframe in which to look for this variable. <code>qplot()</code> will attempt to guess the best <code>geom</code> (graphical geometric representation) with which to display the data. Here we plot a histogram of diamond weights. As we would expect….most diamonds are small, so the graph is skewed.</p>
<pre class="r"><code>library(ggplot2)
qplot(x=carat, data=diamonds)</code></pre>
<pre><code>## stat_bin: binwidth defaulted to range/30. Use &#39;binwidth = x&#39; to adjust this.</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-2-1.png" title="" alt="" width="672" /></p>
</div>
<div id="bivariate-plot" class="section level3">
<h3>Bivariate Plot</h3>
<p>If we specify an additional variable for the y axis, then the default <code>geom</code> is a scatter of points. This time we will also specify a value for <code>main</code> which is the main title.</p>
<pre class="r"><code>qplot(x=carat, y=price, data=diamonds, main=&quot;Diamond Weight by Price&quot;)</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-3-1.png" title="" alt="" width="672" /></p>
</div>
<div id="boxplot" class="section level3">
<h3>Boxplot</h3>
<p>Now lets plot clarity by carat.</p>
<pre class="r"><code>qplot(x=clarity, y=carat, data=diamonds)</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-4-1.png" title="" alt="" width="672" /></p>
<p>We got points as the <code>geom</code>, but we can explicitly tell <code>qplot()</code> to use a different geom.</p>
<pre class="r"><code>qplot(x=clarity, y=carat, data=diamonds, geom=&quot;boxplot&quot;)</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-5-1.png" title="" alt="" width="672" /></p>
</div>
</div>
<div id="layers" class="section level2">
<h2>Layers</h2>
<p>The most common layer you will want to add is a line representing a linear regression. To do this, we start with the bivariate plot, then add a new layer.</p>
<pre class="r"><code>weight_by_price &lt;- qplot(x=carat, y=price, data=diamonds, main=&quot;Diamond Weight by Price&quot;)
weight_by_price + stat_smooth(method=&quot;lm&quot;)</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-6-1.png" title="" alt="" width="672" /></p>
<p>Another common layer you will want to add is an annotation layer. The <code>annotate()</code> function lets you do that.</p>
<pre class="r"><code>weight_by_price + annotate(&quot;text&quot;, x=2, y=25000, label=&quot;Here is a nice annotation, dear reader.&quot;)</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-7-1.png" title="" alt="" width="672" /></p>
<div id="challenge" class="section level3">
<h3><span class="mega-octicon octicon-puzzle"></span> Challenge</h3>
<p>The relationship here is clearly not linear. Recreate the plot in log space by computing the natural log of both variables. To save memory space do the log calculations inline, without saving the logged variables.</p>
</div>
</div>
<div id="color-size-shape-fill" class="section level2">
<h2>Color, Size, Shape, Fill</h2>
<p>Sometimes we want to see the impact of other variables variables by color coding points, or changing the shape or size of points in relation to another variable. <code>qplot()</code> makes this very easy, and even automatically creates legends for us.</p>
<pre class="r"><code>qplot(x=carat, y=price, data=diamonds, main=&quot;Diamond Weight by Price&quot;, color=clarity)</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-8-1.png" title="" alt="" width="672" /></p>
<pre class="r"><code>qplot(x=carat, y=price, data=diamonds, main=&quot;Diamond Weight by Price&quot;, shape=cut)</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-8-2.png" title="" alt="" width="672" /></p>
</div>
<div id="facets" class="section level2">
<h2>Facets</h2>
<p>When we have so many data points, it is hard to tell what is going on. It would be nice to have a grid of sub-plots, so we can see the effect of these factors on the relationship between price and size. We can use the <code>facets</code> argument and tell it which factors we want to use, as in <code>facets=row_var~column_var</code></p>
<pre class="r"><code>qplot(x=carat, y=price, data=diamonds, main=&quot;Diamond Weight by Price&quot;, facets=cut~clarity)</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-9-1.png" title="" alt="" width="672" /></p>
</div>
<div id="themes" class="section level2">
<h2>Themes</h2>
<p>There are a couple of shortcut theme functions that help you customize the look and feel of plots. A very popular one is <code>theme_bw()</code> which gets rid of the default grey background. You can also specify a value for the base text size, to increase size for presentations, etc. All the text elements will scale intelligently. Also check out <code>theme_classic()</code></p>
<pre class="r"><code>qplot(x=carat, y=price, data=diamonds, main=&quot;Diamond Weight by Price&quot;, color=clarity)+ theme_bw(20)</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-10-1.png" title="" alt="" width="672" /></p>
<pre class="r"><code>qplot(x=carat, y=price, data=diamonds, main=&quot;Diamond Weight by Price&quot;, color=clarity) + theme_classic(20)</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-10-2.png" title="" alt="" width="672" /></p>
</div>
<div id="default-themes" class="section level2">
<h2>Default Themes</h2>
<p>To make all of your plots share the same look and feel you can set the theme at the beginning of your script and the theme elements will be applied for all plots. For instance:</p>
<pre class="r"><code>theme_set(theme_bw(20))
qplot(price, data=diamonds)</code></pre>
<pre><code>## stat_bin: binwidth defaulted to range/30. Use &#39;binwidth = x&#39; to adjust this.</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-11-1.png" title="" alt="" width="672" /></p>
<pre class="r"><code>qplot(depth, table, data=diamonds)</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-11-2.png" title="" alt="" width="672" /></p>
</div>
<div id="the-real-ggplot" class="section level2">
<h2>The real ggplot()</h2>
<p>Now I must reveal that you have been using a shortcut, and that you can’t get the full benefit out of <code>ggplot2</code> with the <code>qplot()</code> shortcut.</p>
<p><code>ggplot2</code> is based on the so-called “Grammar of Graphics”, which is a terminology for describing how data is mapped to aesthetic properties to make informative graphics. Plots are comprised of the following</p>
<ul>
<li>background elements (shared by all layers in a plot)
<ul>
<li>coordinate system (usually Cartesian, so we don’t often directly change this)</li>
<li>data - a dataframe which applies to all layers</li>
<li>scales - mapping of data values into plot values (either coordinates or aesthetic properties like color values)</li>
<li>facets (optional) - specification of subplots within a plot, mapped to a column in the dataframe</li>
</ul></li>
<li>layers which are ummm…..layered over the background
<ul>
<li>mapping - optional linking of data columns to aesthetic elements (color,shape,etc), that only apply to a particular layer</li>
<li>data - an optional additional dataframe used only in a particular layer</li>
<li>stat - a statistical transformation of rows in the dataframe (often this is the identity transformation)</li>
<li>geom - choice of how to graphically represent the stat</li>
</ul></li>
</ul>
</div>
<div id="the-ggplot-workflow" class="section level2">
<h2>The ggplot() workflow</h2>
<ul>
<li>invoke the <code>ggplot()</code> function to set background elements which will apply to all layers.
<ul>
<li>supply a base dataframe</li>
<li>use <code>aes()</code> to map dataframe columns to aesthetics. Things you can set include
<ul>
<li><code>color</code></li>
<li><code>fill</code> (the color of polygons or boxplots)</li>
<li><code>shape</code></li>
<li><code>size</code></li>
<li><code>alpha</code> (i.e. transparency)</li>
</ul></li>
<li>Anything not getting mapped to a column (e.g. <code>color=&quot;blue&quot;</code>) doesn’t go inside a call to <code>aes()</code></li>
<li>Use <code>facet_grid()</code> or <code>facet_wrap()</code> to add faceting formula.</li>
</ul></li>
<li>Add layers to the plot, usually using one of the <code>geom_xxx()</code> functions. For a full list of the possibilities try <code>??geom</code> The most common are
<ul>
<li><code>geom_point()</code></li>
<li><code>geom_histogram()</code></li>
<li><code>geom_bar()</code></li>
<li><code>geom_path()</code></li>
<li><code>geom_rect()</code></li>
<li><code>geom_polygon()</code></li>
<li><code>geom_abline()</code></li>
<li><code>geom_text()</code></li>
<li><code>geom_hline()</code> and <code>geom_vline()</code></li>
<li><strong>Note</strong> you can map aesthetics specific to a layer by supplying the appropriate arguments to these functions</li>
<li><strong>Warning</strong> most of these functions will automatically inherit the aesthetics from the background. If you want to override this behavior (e.g. to use a different dataframe), you can use the argument <code>inherit.aes=FALSE</code></li>
</ul></li>
<li>add an annotation layer <code>annotate()</code> to your plot (you can supply more complicated annotations by using a bonafide text layer using <code>geom_text()</code>)</li>
<li>Style the plot and tweak axes etc.
<ul>
<li>Themes are a useful shortcut</li>
<li>There are some helper functions for tweaking plots</li>
<li><code>labs(x=&quot;The X axis label&quot;, title=&quot;my nice little graph&quot;)</code></li>
<li><code>guides()</code> to tweak legend</li>
<li><code>scale_x_continuous(limits=c(0,10))</code> to customize x scale</li>
<li><code>scale_fill_xxx()</code> and <code>scale_color_xxx()</code> for customizing color choices<br /></li>
</ul></li>
<li>Export the plot in a useful format using <code>ggsave()</code></li>
<li>Submit for publication.</li>
</ul>
</div>
<div id="a-full-example" class="section level2">
<h2>A full example</h2>
<p>First we set up the background:</p>
<pre class="r"><code>background &lt;- ggplot(data = diamonds, aes(x = clarity, y=price))</code></pre>
<p><span class="mega-octicon octicon-question"></span> What happens when you type <code>background</code> in the interpreter at this point?</p>
<p>Now we add a boxplot layer:</p>
<pre class="r"><code>with_boxplot &lt;- background + geom_boxplot(aes(fill=cut))
with_boxplot</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-13-1.png" title="" alt="" width="1344" /></p>
<p>Finally, I style my plot with a theme, and make a couple of tweaks</p>
<pre class="r"><code>with_boxplot + 
  theme_bw(20) + 
  labs(title=&quot;Price by Clarity&quot;) + 
  scale_y_continuous(limits=c(0,25000)) + 
  annotate(&quot;text&quot;, x=4.5, y=23000, label=&quot;There are lots of outliers, because people feel societal \npressure to pay a lot for engagement rings \n and or get duped by salespeople #speculation&quot;, size= 4)</code></pre>
<p><img src="visualization_files/figure-html/unnamed-chunk-14-1.png" title="" alt="" width="1344" /></p>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
